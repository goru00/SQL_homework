

/* Создание БД */

CREATE DATABASE `workgroup` COLLATE='utf8_unicode_ci';
USE `workgroup`;

/* Создание структуры */

CREATE TABLE `Должности` (
	`Код должности` INT NOT NULL AUTO_INCREMENT,
	`Наименование должности` VARCHAR(60) NOT NULL,
	PRIMARY KEY (`Код должности`)
);

CREATE TABLE `Персонал` (
	`Код работника` INT NOT NULL AUTO_INCREMENT,
	`ФИО работника` VARCHAR(40) NOT NULL,
	`Телефон` VARCHAR(20) NOT NULL,
	`Код должности` INT NOT NULL,
	`Домашний адрес` VARCHAR(120) NULL,
	PRIMARY KEY (`Код работника`),
	CONSTRAINT `FK_Personal_Appointment` FOREIGN KEY (`Код должности`) REFERENCES `должности` (`Код должности`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Читатели` (
	`Код работника` INT NOT NULL,
	`№ читательского билета` CHAR(6) NOT NULL,
	PRIMARY KEY (`Код работника`),
	UNIQUE INDEX `№ читательского билета` (`№ читательского билета`),
	CONSTRAINT `FK_Readers_Personal` FOREIGN KEY (`Код работника`) REFERENCES `персонал` (`Код работника`) ON UPDATE CASCADE
);

CREATE TABLE `Идентификация пользователей` (
	`Код пользователя` INT NOT NULL,
	`Логин` VARCHAR(40) NOT NULL,
	`Пароль` VARCHAR(40) NOT NULL,
	`Статус пользователя` VARCHAR(20) NOT NULL COMMENT 'Зав. библиотекой, Библиотекарь, Читатель, Работник',
	PRIMARY KEY (`Код пользователя`),
	UNIQUE INDEX `Логин_Пароль` (`Логин`, `Пароль`),
	CONSTRAINT `FK_Users_Personal` FOREIGN KEY (`Код пользователя`) REFERENCES `персонал` (`Код работника`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Общая информация` (
	`Название учреждения` VARCHAR(120) NOT NULL,
	`Юридический адрес` VARCHAR(120) NOT NULL,
	`Код руководителя` INT NOT NULL,
	CONSTRAINT `FK_General_Personal` FOREIGN KEY (`Код руководителя`) REFERENCES `персонал` (`Код работника`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Авторы книг` (
	`Код автора` INT NOT NULL AUTO_INCREMENT,
	`ФИО автора` VARCHAR(40) NOT NULL,
	PRIMARY KEY (`Код автора`)
);

CREATE TABLE `Издательства` (
	`Код издательства` INT(11) NOT NULL AUTO_INCREMENT,
	`Название издательства` VARCHAR(60) NOT NULL,
	`Город` VARCHAR(30) NOT NULL,
	`Сайт издательства` VARCHAR(30) NULL DEFAULT NULL,
	PRIMARY KEY (`Код издательства`)
);

CREATE TABLE `Книги` (
	`ISBN` CHAR(20) NOT NULL,
	`ББК` VARCHAR(20) NULL,
	`Название книги` VARCHAR(160) NOT NULL,
	`Код издательства` INT NOT NULL,
	`Год издания` INT NOT NULL,
	`Количество страниц` INT NULL,
	`Цена` INT NOT NULL,
	PRIMARY KEY (`ISBN`),
	CONSTRAINT `FK_Books_Publishers` FOREIGN KEY (`Код издательства`) REFERENCES `издательства` (`Код издательства`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Книги - авторы` (
	`ISBN` CHAR(20) NOT NULL,
	`Код автора` INT NOT NULL,
	PRIMARY KEY (`ISBN`, `Код автора`),
	CONSTRAINT `FK_BooksAuthors_Books` FOREIGN KEY (`ISBN`) REFERENCES `книги` (`ISBN`) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT `FK_BooksAuthors_Authors` FOREIGN KEY (`Код автора`) REFERENCES `авторы книг` (`Код автора`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Книговыдача` (
	`ФИО` VARCHAR(25) NOT NULL,
	`№ инвентарный` INT NOT NULL,
	`№ читательского билета` CHAR(6) NOT NULL,
	`Дата выдачи` DATE NOT NULL,
	`Дата возврата` DATE NULL,
	`Количество книг на руках` INT NOT NULL,
	PRIMARY KEY (`№ инвентарный`, `№ читательского билета`, `Дата выдачи`, `ФИО`),
	CONSTRAINT `FK_ReaderKey_Readers` FOREIGN KEY (`№ читательского билета`) REFERENCES `читатели` (`№ читательского билета`) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE `Экземпляры книг` (
	`№ инвентарный` INT NOT NULL AUTO_INCREMENT,
	`ISBN` CHAR(20) NOT NULL,
	PRIMARY KEY (`№ инвентарный`),
	CONSTRAINT `FK_Serial_Books` FOREIGN KEY (`ISBN`) REFERENCES `книги` (`ISBN`) ON UPDATE CASCADE ON DELETE CASCADE
);



/* Заполнение БД */

INSERT INTO `авторы книг` (`Код автора`, `ФИО автора`) VALUES
	(1, 'Новиков Ф.А.'),
	(2, 'Шаворев С.Д.'),
	(3, 'Киреев А.П.'),
	(4, 'Киреев П.А.'),
	(5, 'Стариченко Т.Н.'),
	(6, 'Девятко И.Ф.');

INSERT INTO `должности` (`Код должности`, `Наименование должности`) VALUES
	(1, 'Студент'),
	(2, 'Доцент'),
	(3, 'Ст. преподаватель'),
	(4, 'Ассистент'),
	(5, 'Профессор'),
	(6, 'Зав. библиотекой'),
	(7, 'Библиотекарь'),
	(8, 'Ректор');

INSERT INTO `издательства` (`Код издательства`, `Название издательства`, `Город`, `Сайт издательства`) VALUES
	(1, 'Питер', 'СПБ', NULL),
	(2, 'БХВ-Петербург', 'СПБ', NULL),
	(3, 'Финансы и статистика', 'М', NULL),
	(4, 'ИНФА-М', 'Новосибирск', NULL);

INSERT INTO `книги` (`ISBN`, `ББК`, `Название книги`, `Код издательства`, `Год издания`, `Количество страниц`, `Цена`) VALUES
	('5-279-01941-0', '', 'Практикум по теории статистики', 3, 2001, 416, 230),
	('5-93196-328-6', NULL, 'Экономика:Практикум', 3, 2004, 296, 230),
	('5-94723-672-9', NULL, 'Математика для экономистов', 1, 2007, 464, 430),
	('978-5-459-00452-6', NULL, 'Дискретная математика', 1, 2011, 384, 400),
	('978-5-94157-703-3', NULL, 'Дискретная математика. Курс лекций и практических занятий', 2, 2007, 400, 380),
	('978-5-9558-0151-3', NULL, 'Микроэкономика для продвинутых. Задачи и решения. Учебник', 4, 2011, 160, 229),
	('978-5-98227-606-3', NULL, 'Методы социологического исследования: учебное пособие', 4, 2009, 296, 310);

INSERT INTO `персонал` (`Код работника`, `ФИО работника`, `Телефон`, `Код должности`, `Домашний адрес`) VALUES
	(1, 'Иванов С.В.', '8(495)912-54-18', 1, '432356, Курск, ул. Темерязьева, д. 34, кв. 24'),
	(2, 'Сидоров С.Ю.', '8(909)123-34-56', 2, '432367, Котельники, м-н Силикат, д. 45, кв. 12'),
	(3, 'Фонвизина А.И.', '8(904)123-43-56', 6, '333333, Мичуринск, пр-кт Маркса, д. 90, кв. 342'),
	(4, 'Петров И.С.', '8(495)911-39-35', 5, '222234, Москва, ул. Королева, д. 12, кв. 56'),
	(5, 'Воротенко Н.Ф.', '8(495)912-54-18', 1, '554567, Нижние Васюки, ул. Ленина, д. 56'),
	(6, 'Колосов П.С.', '8(906)758-84-92', 1, '556544, Московская обл., с. Куровское, ул. Комсомольская'),
	(7, 'Ершов В.Б.', '8(901)234-56-78', 8, '109147, Москва, Большой факельный пер., д. 38 А');

INSERT INTO `общая информация` (`Название учреждения`, `Юридический адрес`, `Код руководителя`) VALUES
	('НГОУ ВПО Институт Коммерции и Права (на Таганке)', '109147, Москва, Большой факельный пер., д. 38 А', 7);

INSERT INTO `читатели` (`Код работника`, `№ читательского билета`) VALUES
	(1, '1'),
	(2, '2'),
	(3, '3'),
	(4, '4'),
	(5, '5'),
	(6, '6'),
	(7, '7');

INSERT INTO `экземпляры книг` (`№ инвентарный`, `ISBN`) VALUES
	(10564, '5-279-01941-0'),
	(10565, '5-279-01941-0'),
	(10566, '5-279-01941-0'),
	(20001, '5-93196-328-6'),
	(20002, '5-93196-328-6'),
	(20010, '5-94723-672-9'),
	(10533, '978-5-459-00452-6'),
	(10534, '978-5-459-00452-6'),
	(10535, '978-5-459-00452-6'),
	(10536, '978-5-94157-703-3'),
	(10537, '978-5-94157-703-3'),
	(20346, '978-5-94157-703-3'),
	(20011, '978-5-98227-606-3'),
	(20012, '978-5-98227-606-3'),
	(20345, '978-5-98227-606-3');

INSERT INTO `книговыдача` (`ФИО`, `№ инвентарный`, `№ читательского билета`, `Дата выдачи`, `Дата возврата`, `Количество книг на руках`) VALUES
	('Петров',10533, '1', '2012-12-23', NULL, 5),
	('Петренко',10534, '1', '2012-10-02', '2012-12-07', 4),
	('Карпочев',10536, '2', '2012-12-23', NULL, 3),
	('Стулов',10564, '3', '2012-10-02', NULL, 6),
	('Митрохин',20001, '4', '2012-07-05', NULL, 12),
	('Шахов',20010, '2', '2012-12-23', '2012-12-04', 7),
	('Рыбаков',20345, '4', '2012-05-22', NULL, 15),
	('Николин',20346, '4', '2012-06-04', NULL, 12);

INSERT INTO `книги - авторы` (`ISBN`, `Код автора`) VALUES
	('5-94723-672-9', 1),
	('978-5-459-00452-6', 1),
	('5-279-01941-0', 2),
	('978-5-94157-703-3', 2),
	('5-279-01941-0', 3),
	('5-94723-672-9', 3),
	('978-5-9558-0151-3', 3),
	('978-5-9558-0151-3', 4),
	('5-279-01941-0', 5),
	('5-93196-328-6', 5),
	('978-5-98227-606-3', 6);

/*SELECT * FROM `Издательства`; */
/* SELECT #1 */
SELECT `Издательства`.`Код издательства`, `Издательства`.`Название издательства`, `Издательства`.`Город`, `Авторы книг`.`ФИО автора` FROM `Издательства`, `Авторы книг` WHERE `Издательства`.`Название издательства`="Питер";
/* SELECT #2 */
SELECT `Книги`.`Название книги`, `Авторы книг`.`ФИО автора` FROM `Авторы книг`, `Книги` WHERE `Авторы книг`.`ФИО автора` LIKE "%ов%";
/* SELECT #3 */
SELECT `ISBN`, `Название книги`, `Цена`, `Год издания` FROM `Книги` WHERE `Год издания`=2007;
/* SELECT #4 */
SELECT `Книговыдача`.`№ инвентарный`,`Книги`.`Название книги` FROM `книги`, `книговыдача` WHERE `Дата возврата`="2012-12-04" OR `Дата возврата`="2012-12-07" OR `Дата возврата`=NULL;
/* SELECT #5 */
SELECT `Книговыдача`.`№ читательского билета`,`Книговыдача`.`ФИО`, `Книговыдача`.`Количество книг на руках` FROM `книговыдача` WHERE `ФИО` LIKE "%ов%";
/* SELECT #6 */
SELECT `Книговыдача`.`ФИО`, `Книговыдача`.`Количество книг на руках` FROM `Книговыдача` WHERE `ФИО` < 2 ORDER BY `Количество книг на руках` DESC; 
/* SELECT #7 */
SELECT `Книги`.`ISBN`, `Книги`.`Название книги`, `Издательства`.`Название издательства`, `Книги`.`Год издания`, `Книги`.`Цена` FROM `Книги`, `Издательства` ORDER BY WHERE `Цена` BETWEEN 200 AND 500 ORDER BY DESC;
/* SELECT #8 */
